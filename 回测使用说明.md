# BNB 回测使用说明

## 📊 回测功能概述

这个回测系统可以帮助你测试 **Pinbar多周期共振策略** 在BNB币种上的历史表现。

### 策略说明

**Pinbar多周期共振策略** 是一个基于价格形态的交易策略：

1. **形态识别**：
   - Pinbar（做多）：下影线长度 > 实体长度 × 0.67
   - Shooting Star（做空）：上影线长度 > 实体长度 × 0.67

2. **多周期共振**：
   - 同时监测 1H、4H、1D 三个周期
   - 当至少有 2 个周期同时满足形态条件时，触发交易信号

3. **风险管理**：
   - 止损：基于信号K线的最高/最低点
   - 止盈：1.5倍风险距离（1.5R）
   - 每次开仓：100 USDT

## 🚀 快速开始

### 步骤1：安装依赖

首先确保已安装所有必要的Python库：

```bash
cd backend
venv\Scripts\activate
pip install -r requirements.txt
```

如果提示缺少 matplotlib，手动安装：

```bash
pip install matplotlib
```

### 步骤2：运行回测

直接双击运行批处理文件：

```
运行BNB回测.bat
```

或者手动运行：

```bash
cd backend
venv\Scripts\activate
python ..\backtest_bnb.py
```

### 步骤3：查看结果

运行完成后，会生成以下文件：

1. **backtest_trades_bnb.csv** - 详细交易记录
2. **backtest_equity_bnb.csv** - 权益曲线数据
3. **backtest_report_bnb.json** - 回测报告摘要

### 步骤4：可视化结果

双击运行：

```
查看回测图表.bat
```

将自动生成并打开以下图表：

1. **backtest_report_summary.png** - 回测报告摘要
2. **backtest_equity_curve.png** - 权益曲线图
3. **backtest_trade_distribution.png** - 交易分布图
4. **backtest_monthly_returns.png** - 月度收益图

## 📈 回测指标说明

回测完成后，你会看到以下关键指标：

### 基础指标

- **总交易次数**：回测期间完成的交易总数
- **胜率**：盈利交易占总交易的百分比
- **总收益率**：相对于初始资金的收益百分比

### 风险指标

- **最大回撤**：从最高权益到最低权益的最大跌幅
- **平均盈利/亏损**：单笔交易的平均盈亏金额
- **盈亏比**：平均盈利 / 平均亏损
- **盈利因子**：总盈利 / 总亏损（越大越好，>1表示盈利）

## ⚙️ 自定义参数

你可以修改 `backtest_bnb.py` 中的参数：

```python
strategy_config = {
    'ratio': 0.67,          # 影线/实体比例（默认2/3）
    'confluence': 2,        # 共振周期数量（1-3）
    'tp': 1.5,              # 止盈倍数
    'sl': 1.0,              # 止损倍数
    'amount': 100           # 每次开仓金额（USDT）
}

# 回测参数
symbol = 'BNB/USDT'         # 交易对
initial_balance = 1000      # 初始资金
days_back = 365             # 回测天数（默认1年）
```

### 建议参数范围

- **ratio**: 0.5 - 2.0（影线越长，信号越强，但机会越少）
- **confluence**: 1 - 3（数字越大，信号越可靠，但机会越少）
- **tp**: 1.0 - 3.0（止盈距离）
- **sl**: 0.5 - 1.5（止损距离）
- **amount**: 10 - 500（根据你的风险承受能力）

## 📝 其他币种回测

如果想回测其他币种，修改 `backtest_bnb.py` 中的 symbol：

```python
symbol = 'ETH/USDT'  # 以太坊
symbol = 'BTC/USDT'  # 比特币
symbol = 'SOL/USDT'  # Solana
# ... 等等
```

## ⚠️ 注意事项

1. **回测≠实盘**：历史表现不代表未来收益
2. **滑点影响**：实盘交易会有滑点和手续费
3. **网络延迟**：实际执行可能有延迟
4. **数据质量**：回测结果依赖于历史数据的准确性
5. **过度优化**：避免过度优化参数以适应历史数据

## 💡 优化建议

1. **参数优化**：尝试不同的参数组合，找到最优配置
2. **多币种测试**：在多个币种上测试策略的稳定性
3. **不同时期**：测试牛市、熊市、震荡市场的表现
4. **资金管理**：调整每次开仓金额，控制风险
5. **结合其他指标**：可以添加成交量、RSI等过滤条件

## 🔧 故障排查

### 问题1：网络连接失败
- 确保能访问币安API
- 可能需要使用代理

### 问题2：数据获取缓慢
- 这是正常的，需要下载大量历史数据
- 1年数据大约需要5-10分钟

### 问题3：模块导入错误
```bash
pip install --upgrade ccxt pandas numpy matplotlib
```

## 📞 联系支持

如有问题，请查看：
1. 控制台错误信息
2. 检查网络连接
3. 确认Python环境正确激活

---

**祝回测顺利！** 📈✨

